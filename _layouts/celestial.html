{% assign celestial = page.fields %}
<% celestial = {{celestial}}.to_h %>

<% celestial_crystals = [] %>
<% celestial_plants = [] %>

<% if celestial["Is Zodiac?"] == "is_zodiac" %>
	<% celestial["crystals_magical_2"].each do |p| %>
		<% tmpa = $db_crystals_magicals.find { |k| k["id"] == p} %>
		<% celestial_crystals <<  $db_crystals.find { |k| k["id"] == tmpa["fields"]["id_crystal"][0] } %>
	<% end %>
	<% celestial["plants_magical_2"].each do |p| %>
		<% tmpa = $db_plant_magicals.find { |k| k["id"] == p} %>
		<% celestial_plants <<  $db_plants.find { |k| k["id"] == tmpa["fields"]["id_plant"][0] } %>
	<% end %>
<% else %>
	<% celestial["plants_magical"].each do |p| %>
		<% tmpa = $db_plant_magicals.find { |k| k["id"] == p} %>
		<% celestial_plants <<  $db_plants.find { |k| k["id"] == tmpa["fields"]["id_plant"][0] } %>
	<% end %>
	<% celestial["crystals_magical"].each do |p| %>
		<% tmpa = $db_crystals_magicals.find { |k| k["id"] == p} %>
		<% celestial_crystals <<  $db_crystals.find { |k| k["id"] == tmpa["fields"]["id_crystal"][0] } %>
	<% end %>
<% end %>


<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
</head>
<body>
	<a href="..">&larr; Return to Celestials Databank Directory</a>
	<h1>{{celestial.name}}</h1>
	<ul>
		<li>Type: <%= celestial["Type"] %></li>
		<% if celestial["Is Zodiac?"] == 'is_zodiac' %>
			<li>Known Zodiac Symbol</li>
		<% end %>
	</ul>

	<% if celestial_plants.count > 0 %>
		<h3>Associated Plants</h3>
		<% celestial_plants.each do |p| %>
			<%= "<a href='/databank/plants/#{p['fields']['slug']}'>#{p['fields']['name_common']}</a>"  %><br>
		<% end %>
	<% end %>

	<% if celestial_crystals.count > 0 %>
		<h3>Associated Crystals</h3>
		<% celestial_crystals.each do |p| %>
			<%= "<a href='/databank/crystals/#{p['fields']['slug']}'>#{p['fields']['name_common']}</a>" %><br>
		<% end %>
	<% end %>

	<br>
	{% include basic_footer.html %}
</body>
</html>