{% assign crystal = page.fields %}
<% crystal = {{crystal}}.to_h %>


<% crystal_magicals = [] %>
<% if crystal["num_magicals"] > 0 %>
	<% crystal["crystals_magical"].each do |p| %>
		<% crystal_magicals << $db_crystals_magicals.select { |k| k["id"] == p } %>
	<% end %>
<% end %>

<% crystal_magical_sources = [] %>
<% crystal_magical_genders = [] %>
<% crystal_magical_planets = [] %>
<% crystal_magical_zodiacs = [] %>
<% crystal_magical_elements = [] %>
<% crystal_magical_deities = [] %>
<% crystal_magical_chakras = [] %>
<% crystal_magical_effects = [] %>
<% crystal_magical_linked_crystals = [] %>
<% crystal_magical_linked_plants = [] %>

<% crystal_magicals.each do |p| %>
	<% this_item = p[0]["fields"] %>
	<% if this_item.has_key?("gender") %>
		<% crystal_magical_genders << this_item["gender"] %>
	<% end %>
	<% if this_item.has_key?("Planet") %>
		<% this_item["Planet"].each do |o| %>
			<% crystal_magical_planets << $db_celestials.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
	<% if this_item.has_key?("Zodiac") %>
		<% this_item["Zodiac"].each do |o| %>
			<% crystal_magical_zodiacs << $db_celestials.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
	<% if this_item.has_key?("Element") %>
		<% this_item["Element"].each do |o| %>
			<% crystal_magical_elements << $db_elements.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
	<% if this_item.has_key?("Deities") %>
		<% this_item["Deities"].each do |o| %>
			<% crystal_magical_deities << $db_deities.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
	<% if this_item.has_key?("Chakra") %>
		<% this_item["Chakra"].each do |o| %>
			<% crystal_magical_chakras << $db_chakras.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
	<% if this_item.has_key?("Effects") %>
		<% this_item["Effects"].each do |o| %>
			<% crystal_magical_effects << $db_magic_effects.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
	<% if this_item.has_key?("linked_crystals") %>
		<% this_item["linked_crystals"].each do |o| %>
			<% crystal_magical_linked_crystals << $db_crystals.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
	<% if this_item.has_key?("linked_plants") %>
		<% this_item["linked_plants"].each do |o| %>
			<% crystal_magical_linked_plants << $db_plants.select {|k| k["id"] == o} %>
		<% end %>
	<% end %>
<% end %>

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
</head>
<body>
	<a href="..">&larr; Return to Crystals Databank Directory</a>
	<h1>{{crystal.name_common}}</h1>
	<% if crystal.has_key?("names_aka") %>
		<p>Also known as: {{crystal.names_aka}}</p>
	<% end %>
	<hr>
	<% if crystal.has_key?("Copy") %>
		<% if crystal["Copy"].length > 10 %>
			<%= crystal["Copy"] %>
		<% else %>
			{% include frag_helpneeded.html %}
		<% end %>
	<% else %>
		{% include frag_helpneeded.html %} 
	<% end %>
	<hr>
	<h2>{{crystal.name_common}} Spiritual Properties from {{crystal.num_magicals}} sources</h2>
	<hr>
	<% if crystal_magical_genders.count > 0 %>
		<h3>Genders</h3>
		<% crystal_magical_genders.each do |p| %>
			<%= p[0] %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_planets.count > 0 %>
		<h3>Planets</h3>
		<% crystal_magical_planets.each do |p| %>
			<%= "<a href='/databank/celestials/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name']}</a>" %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_zodiacs.count > 0 %>
		<h3>Zodiacs</h3>
		<% crystal_magical_zodiacs.each do |p| %>
			<%= "<a href='/databank/celestials/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name']}</a>" %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_elements.count > 0 %>
		<h3>Elements</h3>
		<% crystal_magical_elements.each do |p| %>
			<%= "<a href='/databank/elements/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name']}</a>" %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_deities.count > 0 %>
		<h3>Deities</h3>
		<% crystal_magical_deities.each do |p| %>
			<%= "<a href='/databank/deities/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name_common']}</a>" %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_chakras.count > 0 %>
		<h3>Chakras</h3>
		<% crystal_magical_chakras.each do |p| %>
			<%= "<a href='/databank/chakras/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name']}</a>"  %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_effects.count > 0 %>
		<h3>Magic Effects</h3>
		<% crystal_magical_effects.each do |p| %>
			<%= "<a href='/databank/magic_effects/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name']}</a>" %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_linked_crystals.count > 0 %>
		<h3>Affinity with Crystals</h3>
		<% crystal_magical_linked_crystals.each do |p| %>
			<%= "<a href='/databank/crystals/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name_common']}</a>" %><br>
		<% end %>
	<% end %>

	<% if crystal_magical_linked_plants.count > 0 %>
		<h3>Affinity with Plants</h3>
		<% crystal_magical_linked_plants.each do |p| %>
			<%= "<a href='/databank/plants/#{p[0]['fields']['slug']}'>#{p[0]['fields']['name_common']}</a>" %><br>
		<% end %>
	<% end %>



	<br>
	{% include basic_footer.html %}
	
</body>
</html>